.Dd April 21, 2008
.Dt GROSSD 1 CON
.Os
.Sh NAME
.Nm grossd
.Nd Greylisting of Suspicious Sources \- the Server
.Sh SYNOPSIS
.Nm grossd 
.Op Fl dCDhnrV
.Op Fl f Ar config
.Op Fl p Ar pidfile
.Op Fl P Ar pidfile
.Ek
.Sh DESCRIPTION
.Nm
is a greylisting server, and more. It's blazingly fast and amazingly
resource efficient. It can be configured to query
.Dv DNSBL
databases, and enforce greylisting only for hosts that are found on those databases.
It can block hosts that match multiple DNSBL's. It can be replicated and
run parallel on two servers. It supports Sun Java System Messaging Server,
Postfix and Exim. Sendmail Milter implementation needs testing. 
.Ss Theory of operation
Gross consists of
.Nm grossd ,
the greylisting daemon, and
a client library for
.Nm SJSMS .
The server also implements
.Nm Postfix Ap s
content filtering protocol.
.Pp
Upon receiving a request from a client, grossd first 
validates it. The request includes a triplet
(smtp-client-ip, sender-address, recipient-address.
A hash is then calculated and matched against the Bloom filter. If a
match is found, and test result does not exceed
.Cm block_threshold
value,
.Nm
sends an OK 
.Dv Pq STATUS_TRUST
message.
.Pp
If the triplet has not been seen before, grossd then
runs configured checks against the client information.
Based on check results grossd returns the client 
a result. Possible results are 
.Dv STATUS_TRUST ,
.Dv STATUS_BLOCK
and
.Dv STATUS_GREY .
The final response is query protocol specific.
.Pp
Then, the Bloom filters are updated according the
.Cm update
configuration option. A Bloom filter is a
very efficient way to store data. It's a probabilistic data
structure, which means that there is a possibility of error when
querying the database. False positives are possible, but false
negatives are not. This means that there is a possibility
that grossd will falsely give an
.Dv STATUS_TRUST
response when a
connection should be greylisted. By sizing the bloom
filters, you can control the error possibility to meet your
needs. The right bloom filter size depends on the number
of entries in the database, that is, the retention time
versus the number of handled connections.
.Sh OPTIONS
.Bl -tag -widht Ds
.It Fl C
Create the statefile and exit. The 
.Cm statefile
configuration option
must be specified in the configuration file.
.It Fl D
Make debugging output more verbose. It can be set twice
for maximum verbosity.
.It Fl d
Run
.Nm
on foreground without daemonizing the process.
grossd will output to terminal instead of using syslog.
.It Fl f Ar config
Specifies the name of the configuration file. The default is
.Pa @sysconfdir@/etc/grossd.conf
.It Fl h
Output short usage information and exit.
.It Fl n
Enable dry-run.
.It Fl P Ar pidfile
Bail out if the pidfile already exists. Create pidfile after the check.
.It Fl p Ar pidfile
Create the pidfile. Overwrite if it already exists.
.It Fl r
Disable replication.
.It Fl V
Output version information and exit.
.El
.Sh FILES
.Pa @sysconfdir@/grossd.conf
.Sh "SECURITY CONSIDERATIONS"
Run
.Nm
under some unprivileged user id. If started as root grossd
will
.Fn setuid
itself to nobody's user id. There are no known security
flaws but you
.Em must not expose
.Nm
to the Internet. It could be used for a DoS against a domains
DNS servers by an attacker as there is no authentication in grossd.
.Sh DIAGNOSTICS
.Xr grossd 8 
daemon exits 0 if success, and >0 if an error occurs.
.Sh "SEE ALSO"
Regarding the configuration both the daemon and MTA's, refer to 
.Xr grossd.conf 5
.Rs
Gross project site:
.Ad http://code.google.com/p/gross/
.Re
.Rs
Bloom filters:
.Ad http://en.wikipedia.org/wiki/Bloom_filter
.Re
.Rs
DNS queries are done asynchronously using c-ares library
.Ad http://daniel.haxx.se/projects/c-ares/ .
.Re
.Sh AUTHORS
.An Eino Tuominen Aq eino@utu.fi
.An Antti Siira Aq antti@utu.fi
